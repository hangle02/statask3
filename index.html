<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ESP32 Motor Control</title>
</head>
<body>
  <h2>Motor Speed Control (BLE)</h2>
  <label>Set Target RPM:</label>
  <input type="number" id="targetRPM" value="150">
  <button onclick="sendRPM()">Send</button>
  <p>Current RPM: <span id="currentRPM">--</span></p>
  <button onclick="connect()">Connect to ESP32</button>

  <script>
    let device, server, service;
    let targetChar, currentChar;

    const serviceUUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
    const targetUUID  = '6e400002-b5a3-f393-e0a9-e50e24dcca9e';
    const currentUUID = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';

    async function connect() {
      device = await navigator.bluetooth.requestDevice({
        filters: [{ namePrefix: 'ESP32' }],
        optionalServices: [serviceUUID]
      });
      server = await device.gatt.connect();
      service = await server.getPrimaryService(serviceUUID);

      targetChar = await service.getCharacteristic(targetUUID);
      currentChar = await service.getCharacteristic(currentUUID);

      await currentChar.startNotifications();
      currentChar.addEventListener('characteristicvaluechanged', e => {
        const val = new TextDecoder().decode(e.target.value);
        document.getElementById('currentRPM').innerText = val;
      });

      alert("Connected to ESP32");
    }

    async function sendRPM() {
      const rpm = document.getElementById('targetRPM').value;
      if (targetChar) {
        const data = new TextEncoder().encode(rpm.toString());
        await targetChar.writeValue(data);
      }
    }
  </script>
</body>
</html>
